<!DOCTYPE html>
<html lang="en-US"
  dir="ltr">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">

<meta name="description" content="" />

<title>
    
    Nextcloud for Dockeræ­å»ºå’Œå¤‡å¿˜ğŸ“ | StarGazer
    
</title>

<link rel="canonical" href="https://kosette.github.io/posts/2024-05-26/" />












<link rel="stylesheet" href="/assets/combined.min.1ddff9327769427ec3c5a9b8c4457be6d1be407395881ad400dd674e4dc37aaf.css" media="all">







  </head>

  

  
  
  

  <body class="light">

    <div class="content">
      <header>
        

<div class="header">

    

    <h1 class="header-title">StarGazer</h1>

    <div class="flex">
        

        
        
      
        <p class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        
      
        <p class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        
        
    </div>

    

</div>

      </header>

      <main class="main">
        




<div class="breadcrumbs">
    
    <a href="/">Home</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a href="/posts/">Posts</a>
    <span class="breadcrumbs-separator"> > </span>
    
    <a class="breadcrumbs-current" href="/posts/2024-05-26/">Nextcloud for Dockeræ­å»ºå’Œå¤‡å¿˜ğŸ“</a>
</div>


<div >

  <div class="single-intro-container">

    

    <h1 class="single-title">Nextcloud for Dockeræ­å»ºå’Œå¤‡å¿˜ğŸ“</h1>
    
    <p class="single-summary">nextcloud æ“ä½œå¤‡å¿˜</p>
    

    

    <p class="single-readtime">
      
      
      
      <time datetime="2024-05-26T03:18:41&#43;08:00">May 26, 2024</time>
      

      
      &nbsp; Â· &nbsp;
      1 min read
      
    </p>

  </div>

  

  

  

  

  <div class="single-content">
    <blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨<code>docker exec</code>è¿›è¡Œçš„ä¿®æ”¹åªæ˜¯ä¸´æ—¶çš„ï¼Œå¦‚æœå®¹å™¨è¢«åˆ é™¤é‚£ä¹ˆæ›´æ”¹å°±ä¼šæ¶ˆå¤±ï¼Œå› æ­¤è¯¸å¦‚<code>docker compose up -d</code>ä¹‹ç±»çš„ä¼šåˆ é™¤ç°æœ‰å®¹å™¨çš„æ“ä½œéƒ½ä¼šç ´åä¿®æ”¹ã€‚</p>
</blockquote>
<p>å®˜æ–¹çš„æ­å»ºæ•™ç¨‹å·²ç»æ¯”è¾ƒå‚»ç“œï¼ŒåŸºæœ¬ä¸Šä½¿ç”¨ docker compose ä¸€æŠŠæ¢­å°±èƒ½èµ·æœåŠ¡ã€‚</p>
<h3 id="redis">Redis</h3>
<p>æœåŠ¡çŠ¶æ€æ£€æŸ¥ä¼šæç¤ºä½¿ç”¨ redis è·å¾—æ›´å¥½çš„è®¿é—®ä½“éªŒï¼Œå¦‚æœå¾ˆè®¨åŒè¿™ä¸ªæé†’ï¼Œå®‰è£… redis æœåŠ¡ä¹Ÿå¾ˆç®€å•ã€‚åœ¨åŸæœ‰çš„ docker-compose.yml ä¸­æ·»åŠ å¦‚ä¸‹é¡¹ç›®ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>nextcloud:
</span></span><span style="display:flex;"><span>  <span style="color:#888;font-style:italic"># æ­¤å¤„çœç•¥å…¶ä»–é¡¹</span>
</span></span><span style="display:flex;"><span>  depends_on:
</span></span><span style="display:flex;"><span>    - redis <span style="color:#888;font-style:italic"># ä¿è¯nextcloudåœ¨redisæœåŠ¡æ›´æ”¹åé‡å¯</span>
</span></span><span style="display:flex;"><span>  environment:
</span></span><span style="display:flex;"><span>    - REDIS_HOST=redis <span style="color:#888;font-style:italic"># é»˜è®¤redisï¼Œå’Œä½ redisæœåŠ¡çš„nameç›¸åŒ</span>
</span></span><span style="display:flex;"><span>    - REDIS_PORT=6379 <span style="color:#888;font-style:italic"># é»˜è®¤ç«¯å£å·</span>
</span></span><span style="display:flex;"><span>    - REDIS_HOST_PASSWORD= <span style="color:#888;font-style:italic"># è‡ªè¡Œå¡«å…¥å¯†ç </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>redis:
</span></span><span style="display:flex;"><span>  image: redis:latest <span style="color:#888;font-style:italic"># ç”Ÿäº§ç¯å¢ƒå¯ä»¥æŒ‡å®šå…·ä½“çš„tagï¼Œæ­¤å¤„æ‹‰å–æœ€æ–°</span>
</span></span><span style="display:flex;"><span>  container_name: redis
</span></span><span style="display:flex;"><span>  restart: always
</span></span><span style="display:flex;"><span>  command: redis-server --requirepass &lt;password&gt; <span style="color:#888;font-style:italic"># æ­¤å¤„æ”¹æˆè‡ªå®šä¹‰å¯†ç ï¼Œéœ€å’Œä¸Šé¢çš„å¯†ç ä¸€è‡´</span>
</span></span></code></pre></div><p>è¿è¡Œ<code>docker compose up -d</code>é‡æ–°éƒ¨ç½²åï¼Œnextcloud ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶å¯ç”¨ redis æœåŠ¡ã€‚</p>
<h3 id="ç´¢å¼•ç¼ºå¤±">ç´¢å¼•ç¼ºå¤±</h3>
<p>nextcloud åœ¨å‡çº§ä¹‹åç»å¸¸ä¼šé‡åˆ°æ­¤é—®é¢˜ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯é‡æ–°ç´¢å¼•ã€‚è¿è¡Œ<code>docker exec -u www-data nextcloud php /var/www/html/occ db:add-missing-indices</code>å³å¯ã€‚</p>
<p>å…¶ä»–ç±»ä¼¼çš„<code>occ maintenance:repair</code>ç­‰ä½¿ç”¨ occ çš„å‘½ä»¤éƒ½å¯ä»¥ç±»ä¼¼æ–¹å¼æ‰§è¡Œã€‚</p>
<h3 id="å…¶ä»–é…ç½®é—®é¢˜">å…¶ä»–é…ç½®é—®é¢˜</h3>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå’Œå…¶ä»–éƒ¨ç½²æ–¹å¼ä¸€æ ·ï¼Œä¿®æ”¹ç›¸å…³çš„é…ç½®å¯ä»¥é€šè¿‡ä¿®æ”¹ config.php æ–‡ä»¶çš„å†…å®¹å®ç°ã€‚æ­¤æ–‡ä»¶åœ¨æ˜ å°„æŒ‚è½½çš„ç›¸å…³ç›®å½•ä¸­ï¼Œè™½ç„¶æ˜¯ Docker éƒ¨ç½²ï¼Œä½†ç›¸å½“å¤šçš„é…ç½®é¡¹å¹¶ä¸æ”¯æŒé€šè¿‡ Docker çš„ç¯å¢ƒå˜é‡è¿›è¡Œé¢„é…ç½®ã€‚ä¸è¿‡ä¿®æ”¹ config.php æ˜¯é«˜é£é™©æ“ä½œï¼Œå»ºè®®åšå¥½å¤‡ä»½æµ‹è¯•ã€‚</p>
<h3 id="è§†é¢‘å°é¢é¢„è§ˆ">è§†é¢‘å°é¢é¢„è§ˆ</h3>
<p>é¢„è§ˆè§†é¢‘å°é¢ä¾èµ– ffmpegï¼Œå¦‚æœé•œåƒä¸­æ²¡æœ‰å®‰è£…ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨å®‰è£…ï¼Œå‘½ä»¤ä¹Ÿå¾ˆç®€å•ï¼Œ<code>docker exec -it nextcloud bash</code>è¿›å…¥å®¹å™¨ï¼Œ<code>apt update &amp;&amp; apt install -y ffmpeg</code>å®‰è£…è½¯ä»¶åŒ…ã€‚</p>
<p>å®é™…çš„æ•ˆæœå¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œä½†æ€»å½’æ¯”é»‘ä¹ä¹ä¸€å¨å¥½çœ‹ä¸€ç‚¹ã€‚</p>
<h3 id="pdf-å°é¢é¢„è§ˆ">PDF å°é¢é¢„è§ˆ</h3>
<p>åŒæ ·éœ€è¦å®‰è£… imagemagick ä¾èµ–ï¼Œå¹¶ä¸”ä¿®æ”¹<code>/etc/ImageMagick-6/policy.xml</code>ä¸­çš„ PDF æƒé™<code>&lt;policy domain=&quot;coder&quot; rights=&quot;read | write&quot; pattern=&quot;PDF&quot; /&gt;</code>ã€‚é‡å¯ nextcloud å®¹å™¨åŸºæœ¬å°±å¯ä»¥æ­£å¸¸ç”Ÿæˆå°é¢é¢„è§ˆäº†ã€‚</p>
<p>å› ä¸ºé•œåƒä¸­æ²¡æœ‰é¢„è£…vim/nanoç­‰ç¼–è¾‘å™¨ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨sedå®ç°ç¼–è¾‘æ›¿æ¢<code>sed -i '/&quot;PDF&quot;/s/none/read|write/g' /etc/ImageMagick-6/policy.xml</code>ï¼Œå¦‚æœä¸ç¡®å®šçš„è¯ï¼Œé‚£ä¹ˆåœ¨å®é™…æ›¿æ¢å‰å¯ä»¥å…ˆæ‰“å°ä¸€ä¸‹ç»“æœ<code>sed -n '/&quot;PDF&quot;/s/none/read|write/gp' /etc/ImageMagick-6/policy.xml</code>ã€‚</p>

    
  </div>

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flex">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">â†</div>
                <div class="single-pagination-text">
                    <a href="/posts/2024-05-09/">
                        å¶åƒçš„é»„æ˜
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
            <div class="single-pagination-container-next">
                <div class="single-pagination-text">
                    <a href="/posts/2024-06-02/">
                        æ—¥æœ‰æ‰€æ€ï¼Œå¤œæœ‰æ‰€æ¢¦
                    </a>
                </div>
                <div class="single-pagination-text">â†’</div>
            </div>
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


      </main>
    </div>

    <footer>
      <p>Powered by
    <a href="https://gohugo.io/">Hugo</a>
    and
    <a href="https://github.com/tomfran/typo">tomfran/typo</a>
</p>


    </footer>

  </body>

  <script>

  function isAuto() {
    return document.body.classList.contains("auto");
  }

  function setTheme() {
    if (!isAuto()) {
      return
    }

    document.body.classList.remove("auto");
    let cls = "light";
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      cls = "dark";
    }

    document.body.classList.add(cls);
  }

  function invertBody() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
  }

  if (isAuto()) {
    window.matchMedia('(prefers-color-scheme: dark)').addListener(invertBody);
  }

  setTheme();

</script>

</html>